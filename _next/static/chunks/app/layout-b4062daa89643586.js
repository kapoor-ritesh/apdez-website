(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{8759:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,2807,23)),Promise.resolve().then(n.t.bind(n,9574,23)),Promise.resolve().then(n.bind(n,3139)),Promise.resolve().then(n.t.bind(n,347,23))},8305:(e,t,n)=>{"use strict";e.exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=void 0,e.exports.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=void 0,e.exports.__SERVER_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=void 0,Object.assign(e.exports,n(2115))},3139:(e,t,n)=>{"use strict";n.d(t,{default:()=>d});var o=n(5155);n(2115);var i=n(22),r=n(595),l=n(1117),a=n(6476),s=n(1764),c=n(8305),_=n(2526),u=function(e){var t=e.client,n=e.children,o=(0,_.l)(),i=c.useContext(o),r=c.useMemo(function(){return(0,a.Cl)((0,a.Cl)({},i),{client:t||i.client})},[i,t]);return(0,s.V1)(r.client,55),c.createElement(o.Provider,{value:r},n)};function d(e){let{children:t}=e;return(0,o.jsx)(i.G_,{clientId:r.y.NEXT_PUBLIC_GOOGLE_CLIENT_ID,children:(0,o.jsx)(E,{children:t})})}function E(e){let{children:t}=e,n=(0,l.A)();return(0,o.jsx)(u,{client:n.apolloClient,children:t})}},1117:(e,t,n)=>{"use strict";n.d(t,{A:()=>f});var o=n(3879),i=n(4806),r=n(8980),l=n(22),a=n(5494),s=n(3099),c=n(1122),_=n(6835),u=n(3634),d=n(595),E=function(e){return e.CREDENTIALS="CREDENTIALS",e.GOOGLE="GOOGLE",e}(E||{});async function p(e){var t=await fetch(d.y.NEXT_PUBLIC_APP_URL+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();return null==n||null==n.token?null:n}async function N(e){var t=await fetch(d.y.NEXT_PUBLIC_APP_URL+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();return null==n||null==n.token?null:n}let T=new a.A(null,{path:"/"});function v(e,t){let n=new Date(Date.now()+1e3*t);T.set("JWT",{token:e,expiry:n},{expires:n})}function O(){let e=T.get("JWT");return null==e?null:{token:e.token,expiry:new Date(Date.parse(e.expiry))}}let h=(0,s.o)(async(e,t)=>{let{headers:n}=t;var o=O();if(null==o)return n;if(Date.now()>o.expiry.getTime()-6e4){let e=await N({token:o.token});(null==e?void 0:e.token)!=null&&(v(null==e?void 0:e.token,null==e?void 0:e.expiresIn),o=O())}return{headers:{...n,authorization:"Bearer ".concat(null==o?void 0:o.token)}}}),L=new c.R({link:h.concat((0,_.$)({uri:"".concat(d.y.NEXT_PUBLIC_APP_URL,"/graphql")})),cache:new u.D});function f(){let e=(0,d.A)(),t=(t,n)=>{null!=t?(v(t.token,t.expiresIn),e.xRedirect(n)):e.xRedirect(i.RF)},n=(0,l.mg)({onSuccess:async e=>{t(await p({authenticationProvider:"GOOGLE",accessToken:e.access_token}),i.MS)},onError:e=>console.log(e)});return{signIn:async function(e){if(d.y.NATIVE&&"google"==e.provider){var r,l;let n=await o.k.signIn();console.log(n),(null==n?void 0:null===(r=n.authentication)||void 0===r?void 0:r.idToken)!=null&&t(await p({accessToken:n.authentication.accessToken,authenticationProvider:"GOOGLE"}),null!==(l=e.redirectUrl)&&void 0!==l?l:i.MS)}else"credentials"==e.provider?t(await p({authenticationProvider:"CREDENTIALS",username:e.username,password:e.password}),i.MS):"google"==e.provider&&n()},signOut:async function(){v(null,0),e.xRedirect(i.m0)},apolloClient:L}}d.y.NATIVE&&(o.k.initialize({clientId:d.y.NEXT_PUBLIC_GOOGLE_CLIENT_ID,scopes:["profile","email"]}).catch(e=>{console.log("Google Auth Error"+e)}),r.q.addListener("backButton",e=>{let{canGoBack:t}=e;t?window.history.back():r.q.exitApp()}))},4806:(e,t,n)=>{"use strict";n.d(t,{MS:()=>o,RF:()=>r,m0:()=>i});let o="/app/",i="/login",r="/login?error=true"},595:(e,t,n)=>{"use strict";n.d(t,{A:()=>l,y:()=>r});var o=n(6046),i=n(9250);let r={NEXT_PUBLIC_GOOGLE_CLIENT_ID:"460406962337-5clh059rbpjpgf0mj5g6o90v244gmbav.apps.googleusercontent.com",NEXT_PUBLIC_APP_URL:"http://192.168.29.42:8080",NATIVE:"ios"==i.Ii.getPlatform()||"android"==i.Ii.getPlatform()};function l(){let e=(0,o.useRouter)();return{xRedirect:function(t){e.push(t)}}}},347:()=>{},9574:e=>{e.exports={style:{fontFamily:"'geistMono', 'geistMono Fallback'"},className:"__className_c3aa02",variable:"__variable_c3aa02"}},2807:e=>{e.exports={style:{fontFamily:"'geistSans', 'geistSans Fallback'"},className:"__className_1e4310",variable:"__variable_1e4310"}},2526:(e,t,n)=>{"use strict";n.d(t,{l:()=>s});var o,i=n(8305),r=n(4476),l=n(1764),a=r.ol?Symbol.for("__APOLLO_CONTEXT__"):"__APOLLO_CONTEXT__";function s(){(0,l.V1)("createContext"in(o||(o=n.t(i,2))),54);var e=i.createContext[a];return e||(Object.defineProperty(i.createContext,a,{value:e=i.createContext({}),enumerable:!1,writable:!1,configurable:!0}),e.displayName="ApolloContext"),e}}},e=>{var t=t=>e(e.s=t);e.O(0,[659,71,242,441,517,358],()=>t(8759)),_N_E=e.O()}]);